(()=>{"use strict";var e=document.querySelector("#card-template").content;function t(t,n,o,r,c){var u=e.querySelector(".places__item").cloneNode(!0),a=u.querySelector(".card__image"),i=u.querySelector(".card__title"),s=u.querySelector(".card__delete-button"),l=u.querySelector(".card__like-button"),d=u.querySelector(".card__like-count");return u.dataset.cardId=t._id,u.dataset.ownerId=t.owner._id,a.src=t.link,a.alt=t.name,i.textContent=t.name,d.textContent=t.likes.length,t.owner._id!==n?s.remove():s.addEventListener("click",function(e){r(e,t._id)}),t.likes.some(function(e){return e._id===n})&&l.classList.add("card__like-button_is-active"),l.addEventListener("click",function(e){o(e.target,t._id)}),a.addEventListener("click",function(e){c(a.src,a.alt,i.textContent)}),u}function n(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",r)}function o(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r)}function r(e){"Escape"===e.key&&o(document.querySelector(".popup_is-opened"))}function c(e){e.target===e.currentTarget&&o(e.currentTarget)}var u,a=function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o),r.textContent=""},i=function(e,t,n){!function(e){return e.some(function(e){return!e.validity.valid})}(e)?(t.classList.remove(n),t.disabled=!1):(t.classList.add(n),t.disabled=!0)},s=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);i(n,o,t.inactiveButtonClass),n.forEach(function(n){a(e,n,t.inputErrorClass,t.errorClass)})},l={baseUrl:"https://nomoreparties.co/v1/wff-cohort-40",headers:{authorization:"9e3f429f-3271-4d80-bfd3-7cf15d7f7b7f","Content-Type":"application/json"}},d=function(e){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:l.headers}).then(function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})},p=function(e){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:l.headers}).then(function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})},f=document.querySelector(".places__list"),_=document.querySelector(".profile__edit-button"),m=document.querySelector(".popup_type_edit"),v=document.querySelector(".profile__add-button"),y=document.querySelector(".popup_type_new-card"),h=document.querySelector(".popup_type_image"),S=document.querySelector(".popup__image"),b=document.querySelector(".popup__caption"),q=document.forms["edit-profile"],k=(document.querySelector(".popup__input_type_name"),document.querySelector(".popup__input_type_description"),document.querySelector(".profile__title")),E=document.querySelector(".profile__image"),L=document.querySelector(".profile__description"),g=(document.querySelector(".popup__button"),document.forms["new-place"]),C=document.querySelector(".popup__input_type_card-name"),j=document.querySelector(".popup__input_type_url"),P=document.querySelector(".popup_type_revision"),x=P.querySelector(".popup__button"),U=document.querySelector(".popup_type_avatar"),w=document.forms["add-avatar"],A=document.querySelector(".profile__image_avatar"),T=document.querySelectorAll(".popup__close"),B={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function D(e,t){e.textContent=t?"Сохранение...":"Сохранить"}function I(e){k.textContent=e.name,L.textContent=e.about,E.style.backgroundImage="url(".concat(e.avatar,")")}function N(e,t,o){S.src=e,S.alt=t,b.textContent=o,n(h)}function O(e,t){n(P),P.dataset.cardId=t}function J(e,t){(e.classList.contains("card__like-button_is-active")?p:d)(t).then(function(t){!function(e,t){e.classList.toggle("card__like-button_is-active"),e.closest(".card").querySelector(".card__like-count").textContent=t}(e,t.likes.length)}).catch(function(e){console.error(e)})}_.addEventListener("click",function(){var e,t,o;s(q,B),e=q,t=k.textContent,o=L.textContent,e.elements.name.value=t,e.elements.description.value=o,n(m)}),v.addEventListener("click",function(){g.reset(),s(g,B),n(y)}),T.forEach(function(e){e.addEventListener("click",function(e){o(e.target.closest(".popup"))})}),A.addEventListener("click",function(e){w.reset(),s(w,B),n(U)}),m.addEventListener("click",function(e){c(e)}),y.addEventListener("click",function(e){c(e)}),h.addEventListener("click",function(e){c(e)}),P.addEventListener("click",function(e){c(e)}),U.addEventListener("click",function(e){c(e)}),x.addEventListener("click",function(e){var t;(t=P.dataset.cardId,fetch("".concat(l.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:l.headers}).then(function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then(function(e){document.querySelector('[data-card-id="'.concat(P.dataset.cardId,'"]')).remove(),o(P)}).catch(function(e){console.log(e)})}),q.addEventListener("submit",function(e){var t;e.preventDefault(),D(q.querySelector(".popup__button"),!0),(t={name:q.name.value,about:q.description.value},fetch("".concat(l.baseUrl,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify({name:t.name,about:t.about})}).then(function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then(function(e){I(e),o(m),s(q,B)}).catch(function(e){console.log(e)}).finally(function(){D(q.querySelector(".popup__button"),!1)})}),g.addEventListener("submit",function(e){var n;e.preventDefault(),D(g.querySelector(".popup__button"),!0),(n={name:C.value,link:j.value},fetch("".concat(l.baseUrl,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify({name:n.name,link:n.link})}).then(function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then(function(e){var n=t(newCard,u,J,O,N);f.prepend(n),o(y),g.reset(),s(g,B)}).catch(function(e){console.log(e)}).finally(function(){D(g.querySelector(".popup__button"),!1)})}),w.addEventListener("submit",function(e){var t;e.preventDefault(),D(w.querySelector(".popup__button"),!0),(t=w.link.value,fetch("".concat(l.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:t})}).then(function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then(function(e){I(e),o(U),s(w,B)}).catch(function(e){console.log(e)}).finally(function(){D(w.querySelector(".popup__button"),!1)})}),Promise.all([fetch("".concat(l.baseUrl,"/users/me"),{headers:l.headers}).then(function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}),fetch("".concat(l.baseUrl,"/cards"),{headers:l.headers}).then(function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})]).then(function(e){var n=e[0];u=n._id;var o=e[1];I(n),function(e,n){e.forEach(function(e){var o=t(e,n,J,O,N);f.append(o)})}(o,u)}).catch(function(e){console.log(e,"Ошибка загрузки инфо о карточках")}),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach(function(t){t.addEventListener("submit",function(e){e.preventDefault()}),function(e,t,n,o,r,c){var u=Array.from(e.querySelectorAll(t)),s=e.querySelector(n);i(u,s,o),u.forEach(function(t){t.addEventListener("input",function(){!function(e,t,n,o){t.validity.valid?a(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),c.textContent=n,c.classList.add(r)}(e,t,t.validationMessage,n,o)}(e,t,r,c),i(u,s,o)})})}(t,e.inputSelector,e.submitButtonSelector,e.inactiveButtonClass,e.inputErrorClass,e.errorClass)})}(B)})();